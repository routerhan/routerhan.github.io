<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"routerhan.github.io","root":"/","scheme":"Muse","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="With this article you will learn   The whole process to use a public helm chart by knowing: How to list and search public charts, How to list and add more repositories, How to build and deploy a publi">
<meta property="og:type" content="article">
<meta property="og:title" content="Helm">
<meta property="og:url" content="https://routerhan.github.io/2020/09/19/hello-world/index.html">
<meta property="og:site_name" content="Chen&#39;s Blog">
<meta property="og:description" content="With this article you will learn   The whole process to use a public helm chart by knowing: How to list and search public charts, How to list and add more repositories, How to build and deploy a publi">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-19T13:35:00.000Z">
<meta property="article:modified_time" content="2020-09-21T15:20:38.207Z">
<meta property="article:author" content="Ching-Han">
<meta property="article:tag" content="Helm">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="DevOps">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://routerhan.github.io/2020/09/19/hello-world/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Helm | Chen's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chen's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-Helm"><span class="nav-number">1.</span> <span class="nav-text">Install Helm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-Hub"><span class="nav-number">2.</span> <span class="nav-text">Helm Hub</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Search-for-available-charts"><span class="nav-number">2.1.</span> <span class="nav-text">Search for available charts</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Add-the-repo"><span class="nav-number">2.2.</span> <span class="nav-text">Add the repo</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hands-on-Practice"><span class="nav-number">3.</span> <span class="nav-text">Hands-on Practice</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Deply-Redis"><span class="nav-number">3.1.</span> <span class="nav-text">Deply Redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Check-Chart-Installation"><span class="nav-number">3.2.</span> <span class="nav-text">Check Chart Installation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Observe-Helm-Deployments"><span class="nav-number">3.3.</span> <span class="nav-text">Observe Helm Deployments</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Connect-to-Your-Redis-Server"><span class="nav-number">3.4.</span> <span class="nav-text">Connect to Your Redis Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Remove-Redis"><span class="nav-number">3.5.</span> <span class="nav-text">Remove Redis</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ching-Han</p>
  <div class="site-description" itemprop="description">A Learning Note</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://routerhan.github.io/2020/09/19/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ching-Han">
      <meta itemprop="description" content="A Learning Note">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Helm
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-19 15:35:00" itemprop="dateCreated datePublished" datetime="2020-09-19T15:35:00+02:00">2020-09-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-21 17:20:38" itemprop="dateModified" datetime="2020-09-21T17:20:38+02:00">2020-09-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/helm/" itemprop="url" rel="index"><span itemprop="name">Helm</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>With this article you will learn </p>
<ul>
<li>The whole process to use a public helm chart by knowing:<ul>
<li>How to list and search public charts,</li>
<li>How to list and add more repositories,</li>
<li>How to build and deploy a public helm chart.<a id="more"></a>


</li>
</ul>
</li>
</ul>
<h3 id="Install-Helm"><a href="#Install-Helm" class="headerlink" title="Install Helm"></a>Install Helm</h3><p>First of all,<br>Install Helm via <code>brew</code> if you are using macOs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install helm</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://helm.sh/docs/intro/install/">Installing Helm</a></p>
<h3 id="Helm-Hub"><a href="#Helm-Hub" class="headerlink" title="Helm Hub"></a>Helm Hub</h3><h4 id="Search-for-available-charts"><a href="#Search-for-available-charts" class="headerlink" title="Search for available charts"></a>Search for available charts</h4><p>For now, there are more than 1400 charts available.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm search hub | wc -l</span><br></pre></td></tr></table></figure>

<p>Let’s have a look on different organzations offering <code>Redis</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm search hub redis</span><br></pre></td></tr></table></figure>
<p>We can find more than 15 Redis related public charts. </p>
<p>One of the well written charts is called <code>Bitnami</code>.<br>So let’s narrow our search with it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm search hub redis | grep bitnami</span><br></pre></td></tr></table></figure>
<h4 id="Add-the-repo"><a href="#Add-the-repo" class="headerlink" title="Add the repo"></a>Add the repo</h4><p>While the chart is listed in Helm Hub, the <code>Bitnami</code> organization has a public repo of all its charts.</p>
<p>Each chart in Helm Hub, there is a repo for user to add for grantting the access of the chart.<br>Let’s say that you want to use <code>redis</code> chart provided by orgranization <code>Bitnami</code>.</p>
<p>You will need to add the repo of <code>Bitnami</code>, so that your Helm can access to its chats:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"><span class="comment">## Your Helm now has access to the Bitnami charts.</span></span><br></pre></td></tr></table></figure>
<p>One can also list all charts provided by the repo.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo list</span><br></pre></td></tr></table></figure>
<p>The Helm command can reveal additional information about the chart.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm show chart bitnami/redis</span><br></pre></td></tr></table></figure>
<p>Also, the readme.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm show readme bitnami/redis</span><br></pre></td></tr></table></figure>
<p>The definable context values.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm show values bitnami/redis</span><br></pre></td></tr></table></figure>
<p>Now you know how to find and list public charts. </p>
<p>In the next step we will deploy the <code>redis</code> chart and observe what happens.</p>
<h3 id="Hands-on-Practice"><a href="#Hands-on-Practice" class="headerlink" title="Hands-on Practice"></a>Hands-on Practice</h3><h4 id="Deply-Redis"><a href="#Deply-Redis" class="headerlink" title="Deply Redis"></a>Deply Redis</h4><p>Assume that you have chosen a chart to deploy into your kubernetes cluster. The first step is to <code>install</code> the chart. Let’s take <code>redis</code> as an example:</p>
<p>Given that you have a cluster named <code>redis</code>, or create by </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create namespace redis</span><br></pre></td></tr></table></figure>
<p>Then, use the install command to deploy the chart to your cluster.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm install my-redis bitnami/redis --version 10.7.16 --namespace redis</span><br></pre></td></tr></table></figure>
<p>This will name a new install called <code>my-redis</code> and install a specific chart name and version into the <code>redis</code> namespace. </p>
<p>With the <code>install</code> command Helm will launch the required Deployments, ReplicaSets, Pods, Services, ConfigMaps, or any other Kubernetes resource the chart defines.</p>
<p>view all the installed charts.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm list --all-namespaces</span><br></pre></td></tr></table></figure>
<p>The installed my-redis chart should be listed.</p>
<h4 id="Check-Chart-Installation"><a href="#Check-Chart-Installation" class="headerlink" title="Check Chart Installation"></a>Check Chart Installation</h4><p>For each chart deployed to the cluster, its deployment information is maintained in a secret stored on the targeted Kubernetes cluster. </p>
<p>With this way, multiple Helm clients can consistently list the installed charts on the cluster. The secrets are deployed to the namespace where the chart is deployed. </p>
<p>The secret names have the <code>sh.helm.</code> prefix.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get secrets --all-namespaces | grep sh.helm</span><br><span class="line"><span class="comment">## redis	sh.helm.release.v1.my-redis.v1	helm.sh/release.v1	1	6m20s</span></span><br></pre></td></tr></table></figure>

<h4 id="Observe-Helm-Deployments"><a href="#Observe-Helm-Deployments" class="headerlink" title="Observe Helm Deployments"></a>Observe Helm Deployments</h4><p>And now, let’s see what happens with the deployment in Helm.</p>
<p>As we mentioned before, Helm will deploy all the defined properties such as Deployments, Pods, Services. </p>
<p>The example <code>redis</code> Pod will be in a <code>Pending</code> state while the container image is downloaded, and stay in <code>Pending</code> state until a <code>Persistent Volume</code> is available. Then the pod will move into <code>Running</code> state.</p>
<p>Use the get command to find out what was deployed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get statefulsets,pods,services -n redis</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NAME                               READY   AGEstatefulset.apps&#x2F;my-redis-master   0&#x2F;1     8m59s</span><br><span class="line">statefulset.apps&#x2F;my-redis-slave    0&#x2F;2     8m59s</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod&#x2F;my-redis-master-0   0&#x2F;1     Pending   0          8m59spod&#x2F;my-redis-slave-0    0&#x2F;1     Pending   0          8m59s</span><br><span class="line"></span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGEservice&#x2F;my-redis-headless   ClusterIP   None            &lt;none&gt;        6379&#x2F;TCP   8m59s</span><br><span class="line">service&#x2F;my-redis-master     ClusterIP   10.98.215.170   &lt;none&gt;        6379&#x2F;TCP   8m59sservice&#x2F;my-redis-slave      ClusterIP   10.98.54.64     &lt;none&gt;        6379&#x2F;TCP   8m59s</span><br></pre></td></tr></table></figure>

<p>The Pod will be in a pending state while the Redis container image is downloaded and until a Persistent Volume is available. You will see a <code>my-redis-master-0</code> and <code>my-redis-slave-0</code> pod.</p>
<h4 id="Connect-to-Your-Redis-Server"><a href="#Connect-to-Your-Redis-Server" class="headerlink" title="Connect to Your Redis Server"></a>Connect to Your Redis Server</h4><p>To make your <code>redis</code> server running, we need to get the secret first by querying the Redis Secret.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> REDIS_PASSWORD=$(kubectl get secret --namespace redis my-redis -o jsonpath=<span class="string">&quot;&#123;.data.redis-password&#125;&quot;</span> | base64 --decode)</span><br></pre></td></tr></table></figure>

<p>Secondly, expose the Redis master service.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl port-forward --namespace redis service/my-redis-master 6379:6379 &gt; /dev/null &amp;</span><br></pre></td></tr></table></figure>
<p>Connect to your database from outside the cluster.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 127.0.0.1 -p 6379 -a <span class="variable">$REDIS_PASSWORD</span> ping</span><br></pre></td></tr></table></figure>
<p>If you see <code>PONG</code> as the response you have connected successfully to the Redis application installed by the Helm chart.</p>
<h4 id="Remove-Redis"><a href="#Remove-Redis" class="headerlink" title="Remove Redis"></a>Remove Redis</h4><p>From previous steps, we have seen the redis running. And now it’s time to take it down.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm delete my-redis -n redis</span><br></pre></td></tr></table></figure>
<p>Noted that, no matter how complex the chart, the delete command will undo everything the install provisioned. The only thin left behind will be the namespace. Delete the namespace if you wish.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete namespace redis</span><br></pre></td></tr></table></figure>

<p>In next article, I will show you how to create your own chart via helm, or we can say to build a helm chart from your own resources.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/helm/" rel="tag"># Helm</a>
              <a href="/tags/k8s/" rel="tag"># Kubernetes</a>
              <a href="/tags/DevOps/" rel="tag"># DevOps</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/09/19/test/" rel="prev" title="Test">
                  <i class="fa fa-chevron-left"></i> Test
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ching-Han</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  















  








  

  

</body>
</html>
